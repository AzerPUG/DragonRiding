local pins =
{
    [2022] = -- The Waking Shores
    {
        {Type = "Glyph", AchieID = 15985, PosX = 75.25, PosY = 56.99, Name = "Skytop Observatory"},
        {Type = "Glyph", AchieID = 15986, PosX = 74.90, PosY = 37.64, Name = "Wingrest Embassy"},
        {Type = "Glyph", AchieID = 15987, PosX = 40.95, PosY = 71.86, Name = "Obsidian Bulwark"},
        {Type = "Glyph", AchieID = 15988, PosX = 54.46, PosY = 74.21, Name = "Ruby Life Pools"},
        {Type = "Glyph", AchieID = 15989, PosX = 46.40, PosY = 52.14, Name = "The Overflowing Spring"},
        {Type = "Glyph", AchieID = 15990, PosX = 52.64, PosY = 17.14, Name = "Life-Binder Observatory"},
        {Type = "Glyph", AchieID = 15991, PosX = 57.66, PosY = 54.93, Name = "Crumbling Life Archway"},
        {Type = "Glyph", AchieID = 16051, PosX = 69.32, PosY = 46.20, Name = "Dragonheart Outpost"},
        {Type = "Glyph", AchieID = 16052, PosX = 73.14, PosY = 20.66, Name = "Scalecracker Peak"},
        {Type = "Glyph", AchieID = 16053, PosX = 21.88, PosY = 51.50, Name = "Obsidian Throne"},
        {Type = "Glyph", AchieID = 16668, PosX = 74.33, PosY = 57.65, Name = "Skytop Observatory Rostrum"},
        {Type = "Glyph", AchieID = 16669, PosX = 58.12, PosY = 78.61, Name = "Flashfrost Enclave"},

        {Type = "Glyph", AchieID = 16670, PosX = 48.80, PosY = 86.64, Name = "Rubyscale Outpost"},
        {Type = "Rostrum",                PosX = 74.07, PosY = 58.11, Name = "Rostrum of transmogrification"},
    },
    [2023] = -- Ohn'Ahran Plains
    {
        {Type = "Glyph", AchieID = 16054, PosX = 57.93, PosY = 31.24, Name = "Ohn'Ahra's Roost"},
        {Type = "Glyph", AchieID = 16055, PosX = 30.51, PosY = 36.00, Name = "Nokhudon Hold"},
        {Type = "Glyph", AchieID = 16056, PosX = 30.15, PosY = 61.40, Name = "Emerald Gardens"},
        {Type = "Glyph", AchieID = 16057, PosX = 29.55, PosY = 75.24, Name = "The Eternal Kurgans"},
        {Type = "Glyph", AchieID = 16058, PosX = 44.69, PosY = 64.61, Name = "Szar Skeleth"},
        {Type = "Glyph", AchieID = 16059, PosX = 47.23, PosY = 72.36, Name = "Mirror of the Sky"},
        {Type = "Glyph", AchieID = 16060, PosX = 57.08, PosY = 80.12, Name = "Ohn'Iri Springs"},
        {Type = "Glyph", AchieID = 16061, PosX = 84.43, PosY = 77.60, Name = "Dragonsprings Summit"},
        {Type = "Glyph", AchieID = 16062, PosX = 86.49, PosY = 39.42, Name = "Rusza'Thar Reach"},
        {Type = "Glyph", AchieID = 16063, PosX = 61.51, PosY = 64.22, Name = "Windsong Rise"},
        {Type = "Glyph", AchieID = 16670, PosX = 79.96, PosY = 13.16, Name = "Rubyscale Outpost"},
        {Type = "Glyph", AchieID = 16671, PosX = 78.36, PosY = 21.28, Name = "Mirewood Fen"},
        {Type = "Rostrum",                PosX = 84.67, PosY = 35.54, Name = "Rostrum of transmogrification"},

    },
    [2024] = -- Azure Span
    {
        {Type = "Glyph", AchieID = 16064, PosX = 45.84, PosY = 25.66, Name = "Cobalt Assembly"},
        {Type = "Glyph", AchieID = 16065, PosX = 39.21, PosY = 62.91, Name = "Azure Archive"},
        {Type = "Glyph", AchieID = 16066, PosX = 68.64, PosY = 60.27, Name = "Ruins of Karnthar"},
        {Type = "Glyph", AchieID = 16067, PosX = 70.56, PosY = 46.25, Name = "Lost Ruins"},
        {Type = "Glyph", AchieID = 16068, PosX = 10.35, PosY = 35.91, Name = "Brackenhide Hollow"},
        {Type = "Glyph", AchieID = 16069, PosX = 26.74, PosY = 31.68, Name = "Creektooth Den"},
        {Type = "Glyph", AchieID = 16070, PosX = 60.59, PosY = 69.96, Name = "Imbu"},
        {Type = "Glyph", AchieID = 16071, PosX = 53.02, PosY = 49.13, Name = "Zelthrak Outpost"},
        {Type = "Glyph", AchieID = 16072, PosX = 67.64, PosY = 29.12, Name = "Kalthraz Fortress"},
        {Type = "Glyph", AchieID = 16073, PosX = 72.45, PosY = 39.73, Name = "Vakthros Range"},
        {Type = "Glyph", AchieID = 16672, PosX = 70.13, PosY = 86.80, Name = "Forkriver Crossing"},
        {Type = "Glyph", AchieID = 16673, PosX = 56.81, PosY = 16.06, Name = "The Fallen Course"},
        {Type = "Rostrum",                PosX = 63.58, PosY = 13.21, Name = "Rostrum of transmogrification"},

    },
    [2025] = -- Thaldraszus
    {
        {Type = "Glyph", AchieID = 16098, PosX = 66.00, PosY = 82.34, Name = "Temporal Conflux"},
        {Type = "Glyph", AchieID = 16099, PosX = 46.00, PosY = 74.07, Name = "Stormshroud Peak"},
        {Type = "Glyph", AchieID = 16100, PosX = 35.56, PosY = 85.54, Name = "South Hold Gate"},
        {Type = "Glyph", AchieID = 16101, PosX = 41.21, PosY = 58.10, Name = "Valdrakken"},
        {Type = "Glyph", AchieID = 16102, PosX = 49.91, PosY = 40.35, Name = "Algeth'Era"},
        {Type = "Glyph", AchieID = 16103, PosX = 61.55, PosY = 56.60, Name = "Tyrhold"},
        {Type = "Glyph", AchieID = 16104, PosX = 62.41, PosY = 40.46, Name = "Algeth'Ar Academy"},
        {Type = "Glyph", AchieID = 16105, PosX = 67.11, PosY = 11.77, Name = "Veiled Ossuary"},
        {Type = "Glyph", AchieID = 16106, PosX = 72.39, PosY = 51.45, Name = "Vault of the Incarnates"},
        {Type = "Glyph", AchieID = 16107, PosX = 72.93, PosY = 69.21, Name = "Thaldrazsus Apex"},
        {Type = "Glyph", AchieID = 16666, PosX = 52.69, PosY = 67.42, Name = "Gelikyr Overlook"},
        {Type = "Glyph", AchieID = 16667, PosX = 55.69, PosY = 72.21, Name = "Passage of Time"},
        {Type = "Rostrum",                PosX = 25.21, PosY = 50.34, Name = "Rostrum of transmogrification"},
    },
    [2112] = -- Valdrakken
    {
        {Type = "Glyph", AchieID = 16101, PosX = 59.31, PosY = 37.28, Name = "Valdrakken"},
    },
    [2151] = -- The Forbidden Reach
    {
        {Type = "Glyph", AchieID = 17398, PosX = 18.33, PosY = 13.18, Name = "Winglord's Perch"},
        {Type = "Glyph", AchieID = 17399, PosX = 20.53, PosY = 91.39, Name = "Talon's Watch"},
        {Type = "Glyph", AchieID = 17400, PosX = 62.54, PosY = 32.34, Name = "Froststone Peak"},
        {Type = "Glyph", AchieID = 17401, PosX = 79.46, PosY = 32.61, Name = "Dragonskull Island"},
        {Type = "Glyph", AchieID = 17402, PosX = 77.34, PosY = 55.12, Name = "Stormsunder Mountain"},
        {Type = "Glyph", AchieID = 17403, PosX = 48.51, PosY = 68.95, Name = "The Frosted Spine"},
        {Type = "Glyph", AchieID = 17404, PosX = 59.05, PosY = 65.06, Name = "Talonlords' Perch"},
        {Type = "Glyph", AchieID = 17405, PosX = 37.72, PosY = 30.66, Name = "Caldera of the Menders"},
    },
    [2133] = -- Zaralek Cavern
    {
        {Type = "Glyph", AchieID = 17510, PosX = 41.75, PosY = 80.65, Name = "Glimmerogg"},
        {Type = "Glyph", AchieID = 17511, PosX = 62.61, PosY = 73.39, Name = "Nal Ks'Kol"},
        {Type = "Glyph", AchieID = 17512, PosX = 54.67, PosY = 54.72, Name = "Loamm"},
        {Type = "Glyph", AchieID = 17513, PosX = 30.43, PosY = 45.32, Name = "Zaqali Caldera"},
        {Type = "Glyph", AchieID = 17514, PosX = 55.19, PosY = 27.90, Name = "Slitherdrake Roost"},
        {Type = "Glyph", AchieID = 17515, PosX = 72.17, PosY = 48.41, Name = "The Throughway"},
        {Type = "Glyph", AchieID = 17516, PosX = 47.42, PosY = 37.02, Name = "Acidbite Ravine"},
        {Type = "Glyph", AchieID = 17517, PosX = 48.07, PosY = 04.70, Name = "Aberrus Approach"},
    }
}

local DragonMapDataProviderMixin = CreateFromMixins(MapCanvasDataProviderMixin)

function DragonMapDataProviderMixin:GetPinTemplate()
	return "DragonMapPinTemplate"
end

function DragonMapDataProviderMixin:OnAdded(...)
    MapCanvasDataProviderMixin.OnAdded(self, ...)
end

function DragonMapDataProviderMixin:OnMapChanged()
    self:RefreshAllData()
end

function DragonMapDataProviderMixin:RefreshAllData()
    local mapInfo = C_Map.GetMapInfo(self:GetMap():GetMapID())
	if FlagsUtil.IsSet(mapInfo.flags, Enum.UIMapFlag.HideVignettes) then
		self:RemoveAllData()
		return
	end

    local newMapID = self:GetMap():GetMapID()
    local pinsForMap = pins[newMapID]
    self:RemoveAllData()
    if pinsForMap then
        for i, pinInfo in ipairs(pinsForMap) do
            if pinInfo.Type == "Glyph" then
                local id, name, points, completed = GetAchievementInfo(pinInfo.AchieID)
                if completed  == false and not AZPHideGlyphs == true then
                    self:GetMap():AcquirePin(self:GetPinTemplate(), pinInfo)
                end
            elseif pinInfo.Type == "Rostrum" then
                if AZPHideRostrums ~= true then
                    self:GetMap():AcquirePin(self:GetPinTemplate(), pinInfo)
                end
            else
                self:GetMap():AcquirePin(self:GetPinTemplate(), pinInfo)
            end
        end
    else
        self:RemoveAllData();
    end
end

function DragonMapDataProviderMixin:RemoveAllData()
	self:GetMap():RemoveAllPinsByTemplate(self:GetPinTemplate())
end

local function OnLoad()
    WorldMapFrame:AddDataProvider(CreateFromMixins(DragonMapDataProviderMixin))
end

DragonMapPinMixin = CreateFromMixins(MapCanvasPinMixin)
function DragonMapPinMixin:OnLoad()
    self.Texture:SetSize(100, 100)
    self.Mask = self:CreateMaskTexture()
    self.Mask:SetPoint("CENTER", self.Texture, "CENTER", 0, 0)
    self.Mask:SetTexture("Interface/CHARACTERFRAME/TempPortraitAlphaMask", "CLAMPTOBLACKADDITIVE", "CLAMPTOBLACKADDITIVE")
    self.Mask:SetSize(90, 90)
    self.Texture:AddMaskTexture(self.Mask)
    self:SetScaleStyle()
    self.HighlightTexture:SetSize(100, 100)
    self:UseFrameLevelType("PIN_FRAME_LEVEL_TOPMOST")
end

function  DragonMapPinMixin:OnAcquired(pinInfo)
    if pinInfo.Type == "Glyph" then
        self.Texture:SetTexture("Interface/ICONS/Ability_DragonRiding_Glyph01")
    elseif pinInfo.Type == "Rostrum" then
        self.Texture:SetAtlas("dragon-rostrum")
    end
    self:SetPosition(pinInfo.PosX / 100, pinInfo.PosY / 100)
end

function DragonMapPinMixin:OnReleased()
end

local EventFrame = CreateFrame("Frame")
EventFrame:RegisterEvent("ADDON_LOADED")
EventFrame:SetScript("OnEvent", function(self, event, ...)
    if event == "ADDON_LOADED" then
        local addon = ...
        if addon == "Blizzard_WorldMap" then
            OnLoad()
        end
    end
end)

if IsAddOnLoaded("Blizzard_WorldMap") then
    OnLoad()
end